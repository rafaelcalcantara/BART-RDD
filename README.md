# Code for BARDDT paper
## Simulation experiments
Folder `Simulations` contains the scripts to perform our simulations. In order to reproduce our results, run the scripts in the following order.
1. File `generate_master_scripts.R` generates scripts to run the simulations for each of the 6 DGPs analyzed in the paper. Alternatively, one can alter lines 2-7 to generate simulation scripts for different DGPs. Lines 8-23, which are commented out, set 2 values for each parameter (one 'easy', one 'hard'). If one wants to explore the simulation setup in more detail, just comment out lines 1-7 and un-comment lines 8-23 to generate simulation scripts for each of those parameter combinations (128 total).
2. Files `run_simulations.R` creates the necessary folders to store the results, sources `generate_master_scripts.R`, and produces a shell command to execute each simulation script.
3. The simulation scripts source file `simulation_estimation_cluster.R` or `simulation_estimation_local.R`, depending on whether we set `cluster <- TRUE` (resp. `cluster <- FALSE`) in `run_simulations.R`. The main difference here is that the former executes the simulation scripts in batches of samples (for running many samples of the same DGP in parallel; useful if we have access to a cluster or even a local PC with good processing power), while the latter executes the scripts sequentially. The number of batches for the parallel execution can be set in line 64 of `generate_master_scripts.R`. Currently, we set `cluster <- TRUE` so the simulations are run in parallel, and recommend leaving that as is even for local runs, unless processing is really an issue.
4. The `estimation` files source:
    a. `simulation_estimator_functions.R`, which create the functions that fit each of the models, and a function `fit_general`. This function sources `simulation_data.R`, which generates the data for a given sample of the current DGP, and executes each of the model functions on this sample
    b. `simulation_process_results.R`, which creates functions to process the results for each DGP, generating the RMSE and CATE fits
5. File `simulation_plots.R` produces the figures and table from the simulation section in the paper

The steps above generate the results for BARDDT, S-BART, T-BART and local polynomial regression, which are all implemented in `R` (the BART models were implemented with package `stochtree`; for more details on the package, please see https://stochtree.ai/). The RD-Tree estimator is only implemented in MATLAB. In order to obtain the results for this estimator, we need to take the samples for each DGP, which will be stored in the `Data` folder in `.rds` format, and convert them into `.csv` to be read in MATLAB. File `data_to_csv.R` does that. Then, in folder `RD-Tree`, we perform the regressions in MATLAB. File `master.m` reads the `.csv` data for a given sample, and generates the file name under which the results will be stored. It then calls file `run_sims.m`, which runs the RD-Tree regressions for that particular sample, and stores them in folder `Results`. For further details on the implementation of RD-Tree, and to see the original example file on which `run_sims.m` was based, please see https://github.com/regulyagoston/RD_tree.
## Empirical application
Folder `Application` contains the data file, `gpa.csv`, and the script that executes our empirical analysis, `application.R`. For further details on the original paper that analyzed this data, the construction of the database, and to access all the complimentary material for that paper --- including the data in `gpa.csv` --- please see https://www.aeaweb.org/articles?id=10.1257/app.2.2.95.